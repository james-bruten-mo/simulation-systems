
<!DOCTYPE html>


<html lang="en" data-content_root="../../" data-theme="auto">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>UM Main Release &#8212; Simulation Systems  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "auto";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "auto";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=880b0107" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Reviewers/releases/um_main_release';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="LFRic Apps Release" href="lfric_apps_release.html" />
    <link rel="prev" title="Mule Release" href="mule_release.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="auto">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/MO_SQUARE_black_mono_for_light_backg_RBG.png" class="logo__image only-light" alt=""/>
    <img src="../../_static/MO_SQUARE_for_dark_backg_RBG.png" class="logo__image only-dark pst-js-only" alt=""/>
  
  
    <p class="title logo__title">Simulation Systems</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../WorkingPractices/working_practices.html">
    Working Practices
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../Development/developing_change.html">
    Developing Your Change
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    Guides for Reviewers
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../FurtherDetails/index.html">
    Further Details
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/MetOffice/simulation-systems/discussions" title="GitHub Discussions" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="far fa-comments fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub Discussions</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/MetOffice/simulation-systems" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../WorkingPractices/working_practices.html">
    Working Practices
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../Development/developing_change.html">
    Developing Your Change
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    Guides for Reviewers
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../FurtherDetails/index.html">
    Further Details
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/MetOffice/simulation-systems/discussions" title="GitHub Discussions" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="far fa-comments fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub Discussions</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/MetOffice/simulation-systems" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><p aria-level="2" class="caption" role="heading"><span class="caption-text">Guides for Reviewers</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../scitechreview.html">Science and Technical Review</a></li>
<li class="toctree-l1"><a class="reference internal" href="../codereview.html">Code Review</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../howtocommit.html">Merge, Test &amp; Commit</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../committinglinkedtickets.html">Committing Linked Pull Requests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nightlytesting.html">Nightly Testing</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../curaterelease.html">Curating a Release</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="um_test_release.html">UM Test Release</a></li>
<li class="toctree-l2"><a class="reference internal" href="partner_testing.html">Partner Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="software_stack.html">Scientific Software Stack Update</a></li>
<li class="toctree-l2"><a class="reference internal" href="jules_release.html">Jules Release</a></li>
<li class="toctree-l2"><a class="reference internal" href="shumlib_release.html">Shumlib Release</a></li>
<li class="toctree-l2"><a class="reference internal" href="mule_release.html">Mule Release</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">UM Main Release</a></li>
<li class="toctree-l2"><a class="reference internal" href="lfric_apps_release.html">LFRic Apps Release</a></li>
<li class="toctree-l2"><a class="reference internal" href="release_notes.html">Release Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="standard_suites.html">Standard Suites</a></li>
<li class="toctree-l2"><a class="reference internal" href="stash_browser.html">Stash Browser</a></li>
<li class="toctree-l2"><a class="reference internal" href="umdp_release.html">UMDP Release</a></li>
<li class="toctree-l2"><a class="reference internal" href="wiki_pages.html">Standard Jobs and Wiki Pages</a></li>
<li class="toctree-l2"><a class="reference internal" href="shared_accounts.html">Repo and Shared Accounts Permissions</a></li>
<li class="toctree-l2"><a class="reference internal" href="updating_prebuilds.html">Mid-Release Prebuilds</a></li>
</ul>
</details></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">Guides for Reviewers</a></li>
    
    
    <li class="breadcrumb-item"><a href="../curaterelease.html" class="nav-link">Curating a Release</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">UM Main Release</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="um-main-release">
<span id="id1"></span><h1>UM Main Release<a class="headerlink" href="#um-main-release" title="Link to this heading">#</a></h1>
<section id="create-branches">
<h2>Create Branches<a class="headerlink" href="#create-branches" title="Link to this heading">#</a></h2>
<p>Ensure you have a <a class="reference internal" href="../../WorkingPractices/forking.html#forking"><span class="std std-ref">fork</span></a> of both the <code class="docutils literal notranslate"><span class="pre">um</span></code> and <code class="docutils literal notranslate"><span class="pre">um_meta</span></code>
repositories, and that the <code class="docutils literal notranslate"><span class="pre">main</span></code> branches in each are up to date with the
upstream repository.</p>
<p>In a clone of these forks, <a class="reference internal" href="../../WorkingPractices/gh_dev_init.html#create-branch"><span class="std std-ref">create a branch</span></a> using the
<code class="docutils literal notranslate"><span class="pre">main</span></code> branch as the parent. In the UM branch, update the <code class="docutils literal notranslate"><span class="pre">um_meta</span></code> entry in
the <code class="docutils literal notranslate"><span class="pre">dependencies.yaml</span></code> file to point at your metadata branch.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Ensure you create branches from main, otherwise you will not include the
changes from the past release.</p>
</div>
</section>
<section id="tagging-feeder-repositories">
<h2>Tagging Feeder Repositories<a class="headerlink" href="#tagging-feeder-repositories" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Add a <code class="docutils literal notranslate"><span class="pre">umX.Y</span></code> tag to each of the feeder repositories</p>
<ul>
<li><p>Casim</p></li>
<li><p>Jules</p></li>
<li><p>Shumlib</p></li>
<li><p>Socrates</p></li>
<li><p>UKCA</p></li>
</ul>
</li>
</ul>
<p>Send an email to all repository owners to let them know that the the head of
the <code class="docutils literal notranslate"><span class="pre">main</span></code> has been tagged.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Jules should already have been done by the Jules release, but this is worth
checking.</p>
</div>
<p>For each of these repositories, modify the <code class="docutils literal notranslate"><span class="pre">ref</span></code> in the UM
<code class="docutils literal notranslate"><span class="pre">dependencies.yaml</span></code> file, to point at the new <code class="docutils literal notranslate"><span class="pre">umX.Y</span></code> tag. Commit this
change to the branch.</p>
</section>
<section id="apply-code-styling">
<h2>Apply Code Styling<a class="headerlink" href="#apply-code-styling" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Switch to the UM branch</p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">RUNFULL=1</span></code> then run ./admin/code_styling/apply_styling</p></li>
<li><p>If any files have changed, check nothing has gone wrong with a quick compile
<code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">vip</span> <span class="pre">-z</span> <span class="pre">g=fcm_make_ex1a_gnu_um_rigorous_omp</span> <span class="pre">-n</span> <span class="pre">um_release_style_check</span>
<span class="pre">./rose-stem</span></code></p></li>
<li><p>Commit any changes</p></li>
</ul>
</section>
<section id="checking-metadata-and-rose-apps">
<h2>Checking Metadata and Rose Apps<a class="headerlink" href="#checking-metadata-and-rose-apps" title="Link to this heading">#</a></h2>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The JULES release must be completed first and all jules-shared metadata
changes from the JULES repository must be centrally installed before
progressing.</p>
</div>
<ul>
<li><p>First switch to the UM branch.</p></li>
<li><p>Check that the metadata meets the Rose standards: run <code class="docutils literal notranslate"><span class="pre">rose</span> <span class="pre">config-dump</span> <span class="pre">-C</span>
<span class="pre">rose-meta</span></code>. Do this before running <code class="docutils literal notranslate"><span class="pre">release_new_version</span></code>, so that any
metadata errors are fixed before the new vnX.Y metadata directories are
created, otherwise you’ll have to check both vnX.Y and HEAD.</p>
<ul>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">difftool</span> <span class="pre">origin/main</span></code>. Are the changes sensible? They often
just involve moving sections of meta-data to be in the correct
alphabetical order.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p><a class="reference external" href="https://code.metoffice.gov.uk/trac/um/ticket/1824">UM:#1824</a> added comments
for some additional triggers ([43853]) to circumvent a bug in Rose.
Running config-dump will move the location of these comments to the
bottom of the that item’s metadata. Check for any moved references
to “issue 2107” (there should be 4 of them) and put them back in the
right places by hand, by referring to an unaltered copy of <code class="docutils literal notranslate"><span class="pre">main</span></code>.</p>
</div>
</li>
</ul>
</li>
<li><p>Check rose-stem meets the Rose standards: run <code class="docutils literal notranslate"><span class="pre">rose</span> <span class="pre">config-dump</span> <span class="pre">-C</span>
<span class="pre">rose-stem/app</span></code>. The version upgrade macro should have reformatted all the
atmos and fcm-make apps, so they should be correct. Are there any other
changes (e.g. to rose-ana apps)? Are they understood? Commit them to the
branch or discuss with the team as appropriate.</p></li>
<li><p>Commit all changes before moving onto the next section.</p></li>
</ul>
</section>
<section id="running-the-release-script">
<h2>Running the Release Script<a class="headerlink" href="#running-the-release-script" title="Link to this heading">#</a></h2>
<p>Move into the rose-stem directory in the UM clone. This is where the release
new version script will be run from. The syntax is,</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>../admin/rose-stem/release_new_version.py<span class="w"> </span>-c<span class="w"> </span>&lt;previous<span class="w"> </span>version&gt;<span class="w"> </span>-n<span class="w"> </span>&lt;new<span class="w"> </span>version&gt;<span class="w"> </span>-j<span class="w"> </span>&lt;new<span class="w"> </span>*JULES*<span class="w"> </span>version&gt;
eg.<span class="w"> </span>../admin/rose-stem/release_new_version.py<span class="w"> </span>-c<span class="w"> </span><span class="m">13</span>.4<span class="w"> </span>-n<span class="w"> </span><span class="m">13</span>.5<span class="w"> </span>-j<span class="w"> </span><span class="m">7</span>.5
</pre></div>
</div>
<ul class="simple">
<li><p>Open a new terminal and inspect that the version number update macro added by
the script is correct, and that the tXXXX template macro has been deleted
appropriately.</p>
<ul>
<li><p>This has caused problems before see <a class="reference external" href="https://code.metoffice.gov.uk/trac/um/wiki/ticket/2437/SciTechReview">this edge case</a>.
The upgrade macro should fail to execute if the macro chain is
incorrect, as it won’t be able to upgrade an app to the new version -
this is likely this edge case.</p></li>
</ul>
</li>
</ul>
</section>
<section id="copying-the-metadata-and-upgrade-macros-to-the-um-meta-branch">
<h2>Copying the metadata and upgrade macros to the um_meta branch<a class="headerlink" href="#copying-the-metadata-and-upgrade-macros-to-the-um-meta-branch" title="Link to this heading">#</a></h2>
<p>The next step is to move the macros and metadata into the meta branch. The
metadata will have been created already by the release script. For each of the
<code class="docutils literal notranslate"><span class="pre">um-atmos</span></code>, <code class="docutils literal notranslate"><span class="pre">um-fcm-make</span></code> and <code class="docutils literal notranslate"><span class="pre">um-createbc</span></code> metadata sections, move the
new <code class="docutils literal notranslate"><span class="pre">vnX.Y</span></code> directory into the <code class="docutils literal notranslate"><span class="pre">um_meta</span></code> clone, eg.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>mv<span class="w"> </span>rose-meta/um-atmos/vnX.Y<span class="w"> </span>/path/to/meta_clone/um-atmos/
<span class="nb">cd</span><span class="w"> </span>/path/to/meta_clone
git<span class="w"> </span>add<span class="w"> </span>um-atmos/vnX.Y
</pre></div>
</div>
<p>Note, there is no need to move um-crmstyle as it only contains HEAD metadata.</p>
<p>In the <code class="docutils literal notranslate"><span class="pre">um_meta</span></code> clone, manually add a line to each of the
<code class="docutils literal notranslate"><span class="pre">um-atmos/versions.py</span></code>, <code class="docutils literal notranslate"><span class="pre">um-fcm-make/versions.py</span></code> and
<code class="docutils literal notranslate"><span class="pre">um-createbc/versions.py</span></code> files to import the newly copied <code class="docutils literal notranslate"><span class="pre">versionXX_XY.py</span></code>
file (see the existing line).</p>
<p>Commit the changes to both the UM and Meta branches.</p>
</section>
<section id="final-checks">
<h2>Final Checks<a class="headerlink" href="#final-checks" title="Link to this heading">#</a></h2>
<p><strong>UM AUX Changes</strong></p>
<p>If there are changes to the AUX <code class="docutils literal notranslate"><span class="pre">main</span></code> in this release, then add a new tag to the
<code class="docutils literal notranslate"><span class="pre">um_aux</span></code> repository and then update the <code class="docutils literal notranslate"><span class="pre">ref</span></code> in the UM
<code class="docutils literal notranslate"><span class="pre">dependencies.yaml</span></code> file - commit this to the branch.</p>
<p><strong>Other Points</strong></p>
<ul class="simple">
<li><p>Check rose-stem/rose-suite.conf?</p>
<ul>
<li><p>Is housekeeping <code class="docutils literal notranslate"><span class="pre">true</span></code>?</p></li>
<li><p>Are the KGO versions correct in the <code class="docutils literal notranslate"><span class="pre">variables.cylc</span></code> file for each
site?</p></li>
<li><p>Does the minimum version of Rose/Cylc need to be increased? (Do any
rose-ana changes require new functionality?)</p></li>
<li><p>Do any of the apps or parts of the suites reference <code class="docutils literal notranslate"><span class="pre">$UMDIR</span></code> - they
shouldn’t (the correct thing to do is to reference
<code class="docutils literal notranslate"><span class="pre">$UM_INSTALL_DIR</span></code>).</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grep</span></code> for any instances of the old version number. Fix as required and
add any corrections to the instructions on this page too.</p></li>
</ul>
<p>Commit any changes resulting from these final checks.</p>
</section>
<section id="preparing-to-test">
<h2>Preparing to Test<a class="headerlink" href="#preparing-to-test" title="Link to this heading">#</a></h2>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>When referring to <strong>all</strong> platforms below, this means Azure Spice, EXAB, EXCD, EXZ</p>
</div>
<ul>
<li><p>Check that a <code class="docutils literal notranslate"><span class="pre">$UMDIR/standard_jobs/inputs/vnX.Y</span></code> input data directory
exists in UMDIR on <strong>all</strong> platforms - this should have been done as part of
the test release.</p>
<ul class="simple">
<li><p>If not, rename the inputs directory <code class="docutils literal notranslate"><span class="pre">$UMDIR/standard_jobs/inputs/vnX.Y</span></code>
to the new version number and be sure to symlink the previous version to
it. Do this all on one line to minimise any glitches during the rename.
This needs to be repeated on all platforms. i.e. to update from vn11.5
to vn11.6 one would run, <code class="docutils literal notranslate"><span class="pre">mv</span> <span class="pre">vn11.5</span> <span class="pre">vn11.6;</span> <span class="pre">ln</span> <span class="pre">-s</span> <span class="pre">vn11.6</span> <span class="pre">vn11.5</span></code>.</p></li>
</ul>
</li>
<li><p>For the rose_ana tasks to pass new KGO also needs to be generated for the new
version, since you are about to run the <code class="docutils literal notranslate"><span class="pre">all</span></code> group test anyway you should
use this opportunity to produce a new set of KGO.</p>
<ul class="simple">
<li><p>KGO is installed using the scripts in SimSys_Scripts. In order for the
script to work you must first change the KGO directories in the
<code class="docutils literal notranslate"><span class="pre">variables.cylc</span></code> and platform-specific <code class="docutils literal notranslate"><span class="pre">variables_PLATFORM.cylc</span></code>
files back to whichever versions were present before the
<code class="docutils literal notranslate"><span class="pre">release_new_version.py</span></code> script was run - you can do this with a
simple copy from the head of main. Be careful to ensure this is
only changing the KGO versions for each variable as expected. <strong>DO NOT
COMMIT this change - you will be reverting it later</strong>.</p></li>
</ul>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>git@github.com:MetOffice/um.git<span class="w"> </span>um_main

cp<span class="w"> </span>um_main/rose-stem/site/meto/variables*<span class="w"> </span>/path/to/um/branch/rose-stem/site/meto/
</pre></div>
</div>
<ul>
<li><p>Current KGO files will have the older UM version in the fixed length
header and lookups. In order for the rose-ana tasks that use mule-cumf
to not give false rose-ana failures we must temporarily ignore the model
version. There is some logic in the UM rose stem suite to enable this.
Open your <code class="docutils literal notranslate"><span class="pre">~/.metomi/rose.conf</span></code> file, on <strong>all</strong> platforms, and add
the following lines to the rose-ana section, making sure that
bypass-version-check is true:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">rose</span><span class="o">-</span><span class="n">ana</span><span class="p">]</span>
<span class="n">bypass</span><span class="o">-</span><span class="n">version</span><span class="o">-</span><span class="n">check</span><span class="o">=.</span><span class="n">true</span><span class="o">.</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</section>
<section id="testing-and-kgo-generation">
<h2>Testing and KGO Generation<a class="headerlink" href="#testing-and-kgo-generation" title="Link to this heading">#</a></h2>
<p>As yourself, and in the clone of the UM branch run rose stem - ensure the
metadata branch has been set in the dependencies.yaml file</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>cylc<span class="w"> </span>vip<span class="w"> </span>-z<span class="w"> </span><span class="nv">g</span><span class="o">=</span>all<span class="w"> </span>-S<span class="w"> </span><span class="nv">HOUSEKEEPING</span><span class="o">=</span><span class="nb">false</span><span class="w"> </span>-S<span class="w"> </span><span class="nv">USE_EXAB</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span>-n<span class="w"> </span>um_release_vnx.y<span class="w"> </span>./rose-stem
</pre></div>
</div>
<p>Before continuing the next step you should make sure the suite has run as
expected. All tests should pass apart from any tasks that output netcdf
(these have _nc in the tasks name) and the SCM tasks. Both of these encode the
UM version and use a direct comparison, it is not as simple to exclude UM
version from the comparison as we did with tests that use mule-cumf.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Check the test results by running something like</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>find<span class="w"> </span>~cylc-run/&lt;suite<span class="w"> </span>name&gt;/runN/log/job<span class="w"> </span>-path<span class="w"> </span><span class="s2">&quot;*rose_ana*&quot;</span><span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-name<span class="w"> </span>job.status<span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="p">|</span><span class="w"> </span>xargs<span class="w"> </span>grep<span class="w"> </span>-l<span class="w"> </span><span class="nv">CYLC_JOB_EXIT</span><span class="o">=</span>ERR<span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-vE<span class="w"> </span><span class="s2">&quot;(scm|netcdf)&quot;</span>
</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">meto_update_kgo.sh</span></code> script is stored in SimSys_Scripts. As yourself,
navigate to <code class="docutils literal notranslate"><span class="pre">$UMDIR/SimSys_Scripts/kgo_updates</span></code> directory and run
<code class="docutils literal notranslate"><span class="pre">./meto_update_kgo.sh</span> <span class="pre">--new-release</span></code> and follow its instructions.</p>
<ul class="simple">
<li><p>First it will ask for all platforms run on, <code class="docutils literal notranslate"><span class="pre">azspice</span> <span class="pre">ex1a</span></code></p></li>
<li><p>It will ask which Host Zone the tests ran on - we specified EXAB so choose
that (Host Zone 1).</p></li>
<li><p>You will need to supply the username and suitename of the suite you ran
above. This will need to include the <code class="docutils literal notranslate"><span class="pre">runX</span></code> directory.</p></li>
<li><p>The version number should be the new version.</p></li>
<li><p>The PR number won’t be used but can be entered as the PR associated
with the release.</p></li>
<li><p>When asked how the new kgo directory should be named overwrite the default
with the name <code class="docutils literal notranslate"><span class="pre">vnX.Y</span></code> where this is the new version number.</p></li>
<li><p>It will show you the settings to double check before you continue.</p>
<ul>
<li><p>Pay particular attention to the preview of the list of commands the
script will present you with to ensure it has accounted for all expected
KGO files.</p></li>
</ul>
</li>
<li><p>The script will install the new kgo on every platform in order azspice-&gt;ex1a.
Once these are finished installing it will rsync to the EXCD and EXZ. To
install the entire kgo database will take some time.</p></li>
</ul>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The authentication for running as the shared user via <code class="docutils literal notranslate"><span class="pre">sudo</span></code> will likely
have expired before each of the 2 rsync commands, so pay attention as the
script nears these points. If you forget and the command times out, the
command can be launched manually from the command line. Ask the team if
for help if required.</p>
</div>
<p>Once you believe you have installed the KGO you should revert the changes
you made to the variables*.cylc files to reset the KGO variables, <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">restore</span>
<span class="pre">rose-stem/site/meto/variables*</span></code></p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Has the ability to reload the test suite been enabled yet? If so <code class="docutils literal notranslate"><span class="pre">cylc</span>
<span class="pre">vr</span></code> can likely be used to restart the original suite.</p>
<p>This is likely the case after moving to GitHub - try and update these WPs if
so.</p>
</div>
<p>The test suite should now be rerun to confirm the kgo has been installed
properly. As we can’t restart Cylc8 rose-stem suites, the entire thing needs
to be rerun. We’re just checking that the kgo has been installed, so it’s
probably unnecessary to wait for the entire thing - instead just ensure a
reasonable range of rose-ana tasks have passed.</p>
</section>
<section id="review-and-commit">
<h2>Review and Commit<a class="headerlink" href="#review-and-commit" title="Link to this heading">#</a></h2>
<p>Ensure all changes are committed to both branches and then create a PR for each
of the <code class="docutils literal notranslate"><span class="pre">um</span></code> and <code class="docutils literal notranslate"><span class="pre">um_meta</span></code> branches and pass along for a review and commit.</p>
<p>You and the reviewer should work through the process of committing the branches
together - <a class="reference internal" href="../curaterelease.html#github-releases"><span class="std std-ref">see here for details page</span></a>.</p>
</section>
<section id="install-the-release">
<h2>Install the Release<a class="headerlink" href="#install-the-release" title="Link to this heading">#</a></h2>
<p>First get a local clone of the head of the <code class="docutils literal notranslate"><span class="pre">um</span></code> repository, now that the
release has been committed. This makes it available to the shared account
without having to rely on the mirrors.</p>
<p>The main installation of ctldata, utilities and prebuilds can now take place.
This all takes place as the <code class="docutils literal notranslate"><span class="pre">umadmin</span></code> account so log in to that now.</p>
<p>Copy the <code class="docutils literal notranslate"><span class="pre">um</span></code> clone you created just now.</p>
<p>First check that the upgrade has gone successfully and the new install will
appear in the correct place. Do this by running,</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>cylc<span class="w"> </span>vip<span class="w"> </span>-z<span class="w"> </span><span class="nv">g</span><span class="o">=</span>install<span class="w"> </span>-S<span class="w"> </span><span class="nv">CENTRAL_INSTALL</span><span class="o">=</span><span class="nb">false</span><span class="w"> </span>-S<span class="w"> </span><span class="nv">USE_EXAB</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span>-z<span class="w"> </span>umx.y_install<span class="w"> </span>./rose-stem
</pre></div>
</div>
<p>and check that <code class="docutils literal notranslate"><span class="pre">~umadmin/cylc_run/&lt;working_copy_name&gt;/runN/share/vnX.Y</span></code>
exists and is the new version number. If that has worked, change the
CENTRALL_INSTALL flag to true and rerun,</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>cylc<span class="w"> </span>vip<span class="w"> </span>-z<span class="w"> </span><span class="nv">g</span><span class="o">=</span>install<span class="w"> </span>-S<span class="w"> </span><span class="nv">CENTRAL_INSTALL</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span>-S<span class="w"> </span><span class="nv">USE_EXAB</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span>-z<span class="w"> </span>umx.y_install<span class="w"> </span>./rose-stem
</pre></div>
</div>
<p>Next, rerun the install for the 2nd host zone,</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>cylc<span class="w"> </span>vip<span class="w"> </span>-z<span class="w"> </span><span class="nv">g</span><span class="o">=</span>ex1a_install<span class="w"> </span>-S<span class="w"> </span><span class="nv">CENTRAL_INSTALL</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span>-S<span class="w"> </span><span class="nv">USE_EXCD</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span>-z<span class="w"> </span>umx.y_install<span class="w"> </span>./rose-stem
</pre></div>
</div>
<p>Finally, rerun the install for the EXZ,</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>cylc<span class="w"> </span>vip<span class="w"> </span>-z<span class="w"> </span><span class="nv">g</span><span class="o">=</span>ex1a_install<span class="w"> </span>-S<span class="w"> </span><span class="nv">CENTRAL_INSTALL</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span>-S<span class="w"> </span><span class="nv">USE_EXZ</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span>-z<span class="w"> </span>umx.y_install<span class="w"> </span>./rose-stem
</pre></div>
</div>
<p>The release is now installed and can be announced.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>This is the point at which prebuilds used to be created. If prebuilds become
possible again, update the working practices here.</p>
</div>
</section>
<section id="monsoon-installation">
<h2>Monsoon Installation<a class="headerlink" href="#monsoon-installation" title="Link to this heading">#</a></h2>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>This section can be done in parallel with the previous one</p>
</div>
<p>We also install the UM onto Monsoon - to do this you will need a Monsoon
account with access to the <code class="docutils literal notranslate"><span class="pre">umadmin.mon</span></code> shared account.</p>
<p>First, log into Monsoon as <code class="docutils literal notranslate"><span class="pre">umadmin.mon</span></code> and then clone the <code class="docutils literal notranslate"><span class="pre">um</span></code> repo.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>At time of writing, the solution for extracting from GitHub on Monsoon has
not been announced.</p>
</div>
<p>Next, symlink the input data as was done for other platforms,</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>mv<span class="w"> </span>vn11.5<span class="w"> </span>vn11.6<span class="p">;</span><span class="w"> </span>ln<span class="w"> </span>-s<span class="w"> </span>vn11.6<span class="w"> </span>vn11.5
</pre></div>
</div>
<p>Now run the central install group,</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>cylc<span class="w"> </span>vip<span class="w"> </span>-z<span class="w"> </span><span class="nv">g</span><span class="o">=</span>ex1a_install<span class="w"> </span>-S<span class="w"> </span><span class="nv">CENTRAL_INSTALL</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span>-z<span class="w"> </span>umx.y_install<span class="w"> </span>./rose-stem
</pre></div>
</div>
<p>Install prebuilds on Monsoon. Note the <code class="docutils literal notranslate"><span class="pre">--no-run-name</span></code> is required to force
the install location to be consistent with other platforms.</p>
<p>Finally we need to install the kgo for the release. Do this by running the
<code class="docutils literal notranslate"><span class="pre">ex1a</span></code> group. Once that is finished, run the kgo install script(sourced from
the SimSys_Scripts repo).</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>cylc<span class="w"> </span>vip<span class="w"> </span>-z<span class="w"> </span><span class="nv">g</span><span class="o">=</span>ex1a<span class="w"> </span>-n<span class="w"> </span>umx.y_kgo<span class="w"> </span>./rose-stem

<span class="c1"># Wait for tests to complete</span>
python3<span class="w"> </span>SimSys_Scripts/kgo_updates/kgo_update/kgo_update.py<span class="w"> </span>-N<span class="w"> </span>vnX.Y<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-P<span class="w"> </span>ex1a<span class="w"> </span>--new-release<span class="w"> </span>--non-interactive
</pre></div>
</div>
<p>Check that the kgo has been installed in place correctly at
<code class="docutils literal notranslate"><span class="pre">$UMDIR/standard_jobs/kgo</span></code>.</p>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="mule_release.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Mule Release</p>
      </div>
    </a>
    <a class="right-next"
       href="lfric_apps_release.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">LFRic Apps Release</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-branches">Create Branches</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tagging-feeder-repositories">Tagging Feeder Repositories</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#apply-code-styling">Apply Code Styling</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#checking-metadata-and-rose-apps">Checking Metadata and Rose Apps</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-the-release-script">Running the Release Script</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#copying-the-metadata-and-upgrade-macros-to-the-um-meta-branch">Copying the metadata and upgrade macros to the um_meta branch</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#final-checks">Final Checks</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preparing-to-test">Preparing to Test</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-and-kgo-generation">Testing and KGO Generation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#review-and-commit">Review and Commit</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#install-the-release">Install the Release</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#monsoon-installation">Monsoon Installation</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

<p class="copyright">
    
    © Crown Copyright, Met Office
    <br/>
    
</p>
</div>
      
    </div>
  
  
    <div class="footer-items__center">
      
        <div class="footer-item">
<div class="tocsection accessibilitylink">
        <a href="../../accessibility.html">Accessibility</a>
</div></div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.2.3.
    <br/>
  </p>
</div>
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>